# --- DISCORD webhooks ---
DISCORD_WEBHOOK_URL=                         # REQUIRED: main alerts channel
DISCORD_ADMIN_WEBHOOK=                       # optional: admin/dev channel for heartbeats

# --- Phase B feature flags (safe defaults off) ---
# When enabled, preliminary classification in feeds/analyzer uses the new classify.classify() adapter.
FEATURE_CLASSIFIER_UNIFY=0                   # 1=enable unified classifier bridge
# When enabled, the analyzer will post a truncated summary markdown as an embed to the admin webhook.
FEATURE_ADMIN_EMBED=0                        # 1=enable analyzer summary embed
# When enabled, alerts will include intraday indicators (VWAP/RSI14) when available.
FEATURE_INDICATORS=0                         # 1=enable intraday indicators enrichment

# Optional path to a specific analyzer summary markdown file for admin embed.
# If unset, the helper auto-selects the newest summary_*.md under out/analyzer.
ADMIN_SUMMARY_PATH=

# --- Features ---
FEATURE_ALERTS=1                             # 1=enable alerts
FEATURE_HEARTBEAT=1                          # 1=send boot/interval heartbeats
FEATURE_RECORD_ONLY=0                        # 1=don’t post alerts, only log

# Heartbeat cadence in minutes (0=only at boot and manual)
HEARTBEAT_INTERVAL_MIN=0

# --- Classification gates (all optional; blank disables) ---
MIN_SCORE=
MIN_SENT_ABS=
CATEGORIES_ALLOW=                            # CSV of categories to allow (case-insensitive)

# --- Sources & filters ---
SKIP_SOURCES=                                # e.g. sec_fwp to cut noise while testing
PRICE_CEILING=                               # e.g. 10.0 to skip tickers > $10
IGNORE_INSTRUMENT_TICKERS=1                  # 1=drop warrants/units/etc

# --- Ticker extraction flags ---
ALLOW_OTC_TICKERS=0                          # 1=allow OTCMKTS/OTCQX/OTCQB prefixes
DOLLAR_TICKERS_REQUIRE_EXCHANGE=0            # 1=drop bare $TICKER unless exchange-qualified

# --- Rate limiting / pacing (alerts.py) ---
ALERTS_RESPECT_RL_ON_SUCCESS=1               # gently pace when Discord bucket empties
ALERTS_MIN_INTERVAL_MS=300                   # soft spacing per webhook (ms)
ALERTS_JITTER_MS=150                         # random jitter added after success (ms)
MAX_ALERTS_PER_CYCLE=40                      # cap per run loop

# Per-key burst limiter (alerts_rate_limit.py). Off by default in prod.
HOOK_ALERTS_RATE_LIMIT=0
ALERTS_RATE_WINDOW_SECS=60
ALERTS_RATE_MAX=4

# --- Analyzer / misc ---
TICKERS_DB_PATH=                             # optional override; else data/tickers.db

# --- Logging ---
LOG_LEVEL=INFO                               # DEBUG, INFO, WARNING, ERROR

# --- Finviz Elite (news export) ---
FINVIZ_ELITE_AUTH=                               # paste your Finviz Elite API token (legacy/fallback)
FINVIZ_AUTH_TOKEN=                               # preferred Finviz API token; falls back to FINVIZ_ELITE_AUTH when unset
FEATURE_FINVIZ_NEWS=1                            # 1=enable, 0=disable
FINVIZ_NEWS_KIND=stocks                          # market|stocks|etfs|crypto
FINVIZ_NEWS_TICKERS=                             # optional CSV filter: e.g. AAPL,MSFT
FINVIZ_NEWS_INCLUDE_BLOGS=0                      # 0=news only, 1=include blogs
FINVIZ_NEWS_MAX=200                              # cap items per pull
FINVIZ_NEWS_TIMEOUT=10                           # seconds
# FINVIZ_NEWS_PARAMS=pid=12345                   # optional extra query params (e.g., portfolio id)

# --- Phase‑C: Provider & sentiment features ---
#
# Tiingo real‑time quotes: set your Tiingo API key and flip FEATURE_TIINGO=1
# to prefer Tiingo for last/prev price snapshots.  The default provider order
# is ``tiingo,av,yf`` – see MARKET_PROVIDER_ORDER below.  When this flag is
# off or the key is blank, the bot falls back to Alpha Vantage and yfinance.
FEATURE_TIINGO=0
TIINGO_API_KEY=

# Financial Modeling Prep stock news sentiment feed.  When enabled, the bot
# fetches sentiment scores via the FMP RSS endpoint and attaches a
# ``sentiment_fmp`` field to events.  The free feed does not require a key,
# but future tiers may.  Leave FMP_API_KEY blank unless you have one.
FEATURE_FMP_SENTIMENT=0
FMP_API_KEY=

# Finviz news export feed.  The Elite plan allows exporting filtered news
# as CSV via a custom URL.  Provide your export URL (including v= and auth
# parameters) here and set FEATURE_FINVIZ_NEWS_EXPORT=1 to enable.  Rows
# without tickers will be included as general market news.
FEATURE_FINVIZ_NEWS_EXPORT=0
FINVIZ_NEWS_EXPORT_URL=

# Watchlist support.  When FEATURE_WATCHLIST=1 the bot will load the CSV
# defined by WATCHLIST_CSV once per cycle and bypass the price ceiling for
# tickers on the list.  The file must have a ``ticker`` column and may
# include optional ``rationale`` or ``weight`` columns.
FEATURE_WATCHLIST=0
WATCHLIST_CSV=data/watchlist.csv

# Rich alert charts.  Set FEATURE_RICH_ALERTS=1 to attach an intraday
# candlestick chart for each alert.  Charts require Matplotlib and
# mplfinance; if unavailable the bot will silently skip chart rendering.
FEATURE_RICH_ALERTS=0

# --- Patch‑5: Watchlist cascade and 52‑week low scanner ---
# When enabled, the bot maintains a stateful watchlist where tickers decay from
# HOT to WARM to COOL over time.  The state is persisted to the JSON file
# defined by WATCHLIST_STATE_FILE (see below).  Set FEATURE_WATCHLIST_CASCADE=1
# to enable cascading behaviour.  Durations are specified in days.
FEATURE_WATCHLIST_CASCADE=0
# Number of days to keep a ticker in the HOT state before demoting to WARM.
WATCHLIST_HOT_DAYS=7
# Number of days to keep a ticker in the WARM state before demoting to COOL.
WATCHLIST_WARM_DAYS=21
# Number of days to keep a ticker in the COOL state before it can be removed.
# Currently, COOL tickers remain indefinitely; this setting is reserved for
# future use.
WATCHLIST_COOL_DAYS=60
# Path to the JSON file used to persist the cascade state.  Relative paths
# are resolved relative to the project root.  Defaults to data/watchlist_state.json.
WATCHLIST_STATE_FILE=data/watchlist_state.json

# Enable the 52‑week low scanner.  When enabled, the bot will query Finviz
# for tickers making new 52‑week lows and add them to the watchlist cascade.
FEATURE_52W_LOW_SCANNER=0
# Percentage above the 52‑week low considered "near" the low.  Finviz does
# not currently expose a distance filter, so this value is unused for now
# but is reserved for future expansion.
LOW_DISTANCE_PCT=5
# Minimum average daily volume (shares) required to consider a stock for the
# 52‑week low scanner.  Use 0 to disable the volume filter.  Defaults to
# 300000 shares.
LOW_MIN_AVG_VOL=300000

# Alpaca streaming.  When FEATURE_ALPACA_STREAM=1 and valid credentials are
# provided, the bot subscribes to the Alpaca websocket for each alerted
# ticker for up to STREAM_SAMPLE_WINDOW_SEC seconds after posting.  This can
# provide more timely price updates.  Leave this disabled if you do not
# have an Alpaca IEX API subscription.
FEATURE_ALPACA_STREAM=0
ALPACA_API_KEY=
ALPACA_SECRET=
STREAM_SAMPLE_WINDOW_SEC=0

# Admin digest & approval loop.  Enabling FEATURE_APPROVAL_LOOP causes the
# analyzer to write pending plan files and wait for approval before
# applying weight adjustments.  Approval marker files are stored under
# APPROVAL_DIR.  Admin summary embeds require FEATURE_ADMIN_EMBED=1 and a
# valid DISCORD_ADMIN_WEBHOOK.
FEATURE_APPROVAL_LOOP=0
APPROVAL_DIR=out/approvals

# Earnings calendar cache.  Path to the cached earnings calendar pulled by
# ``python -m catalyst_bot.jobs.earnings_pull``.  The analyzer will read
# this file and annotate earnings days in its summary.  Change this path
# if you wish to store the calendar elsewhere.
EARNINGS_CALENDAR_CACHE=data/earnings_calendar.csv

# Provider order.  Comma‑separated list of price providers to query for
# last/prev snapshots.  Recognised values: ``tiingo``, ``av`` (Alpha Vantage),
# ``yf`` (yfinance).  The default order is ``tiingo,av,yf``.  You can skip
# providers (e.g. av,yf) or reorder them via this variable.
MARKET_PROVIDER_ORDER=tiingo,av,yf

# Backtest provider order.  Overrides ``MARKET_PROVIDER_ORDER`` for the
# backtest simulator.  Provide a comma‑separated list of providers in
# the desired priority for historical simulations.  If blank, the
# simulator falls back to MARKET_PROVIDER_ORDER.  Recognised values
# include ``tiingo``, ``av``, ``alpha`` and ``yf``.
BACKTEST_PROVIDER_ORDER=

# Plain logging mode.  When LOG_PLAIN=1 the bot emits human‑readable
# one‑line logs to the console.  Structured JSON logs are still written to
# data/logs/bot.jsonl for downstream ingestion.  Leave at 0 to use
# compact JSON logs on the console.
LOG_PLAIN=0

# --- Patch‑2: QuickChart, momentum and local sentiment ---
# Generate hosted candlestick charts via the QuickChart API.  When this flag
# is enabled, the bot will build a Chart.js config and return an image URL.
# If disabled, the bot falls back to rich alerts (matplotlib) or Finviz charts.
FEATURE_QUICKCHART=0

# Optional QuickChart API key.  Providing a key increases the API rate limit for
# QuickChart's /chart/create endpoint used to shorten long Chart.js configs.
# Leave blank if you do not have a key.
QUICKCHART_API_KEY=

# Compute additional intraday momentum indicators (MACD, EMA crosses, VWAP delta)
# from recent price history.  Requires FEATURE_INDICATORS=1 to have an effect.
FEATURE_MOMENTUM_INDICATORS=0

# Use a local sentiment analyser when external feeds are unavailable.  When
# enabled, the bot will compute a VADER/lexicon-based sentiment score for
# each headline and display it alongside FMP sentiment (when available).
FEATURE_LOCAL_SENTIMENT=0

# --- Patch‑2: Breakout scanner ---
# Enable the proactive breakout scanner.  When turned on, the bot will query
# Finviz Elite for sub‑$10 tickers with unusual volume and new highs and
# generate events for them.  Requires a valid FINVIZ_AUTH_TOKEN.
FEATURE_BREAKOUT_SCANNER=0
# Minimum average daily volume (shares) a ticker must have to be considered a
# breakout candidate.  Values are plain numbers (e.g. 300000 for 300k).  Set
# to 0 to disable the avg volume filter.
BREAKOUT_MIN_AVG_VOL=300000
# Minimum relative volume threshold (> 1 indicates higher than usual activity).
# Use a decimal value such as 1.5.  Set to 0 to disable the relative volume filter.
BREAKOUT_MIN_RELVOL=1.5

# --- Patch‑3: Deduplication & duplicate suppression ---
# Enable refined deduplication across sources and cycles.  When
# FEATURE_DEDUP_REFINED=1 the bot persists a first‑seen index in
# ``data/dedup/first_seen.db`` and suppresses re‑alerting for previously
# observed signatures.  Defaults to 0 (off) for backwards compatibility.
FEATURE_DEDUP_REFINED=0

# Persistent seen store.  When enabled (default), the bot will maintain a
# lightweight SQLite database (``data/seen_ids.sqlite``) to keep track of
# item IDs that have already been alerted on.  This prevents duplicate
# notifications across cycles and restarts.  Set FEATURE_PERSIST_SEEN=0 to
# disable persistent storage (in‑memory TTL still applies).
FEATURE_PERSIST_SEEN=1

# Duplicate suppression TTL for the in‑memory seen cache.  The bot uses
# a small in‑process cache to suppress duplicate alerts for a period of
# time even when persistent dedup is disabled.  Specify the TTL in
# seconds.  The default is 900 seconds (15 minutes).  Increase this
# value to avoid repeat alerts over longer periods (e.g. 86400 for 24 hours).
SEEN_TTL_SECONDS=900

# TTL for the persistent seen store, in days.  Entries older than this
# many days are purged on startup.  Defaults to 7 days if unset.  You
# usually don’t need to change this unless your alert cadence is very
# high.
SEEN_TTL_DAYS=7
