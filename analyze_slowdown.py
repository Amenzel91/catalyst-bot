#!/usr/bin/env python3
"""Analyze cycle slowdown from Dec 9, 2025 logs."""

import statistics
from datetime import datetime

# Raw data extracted from logs
data_raw = """2025-12-09T23:17:09Z
632.80
2025-12-09T23:28:11Z
632.12
2025-12-09T00:57:45Z
19.06
2025-12-09T00:58:35Z
19.26
2025-12-09T00:59:23Z
18.61
2025-12-09T01:00:13Z
19.87
2025-12-09T01:01:02Z
18.96
2025-12-09T02:01:22Z
19.52
2025-12-09T03:01:43Z
18.68
2025-12-09T04:02:03Z
18.57
2025-12-09T05:02:23Z
18.06
2025-12-09T06:02:36Z
11.18
2025-12-09T06:30:27Z
18.07
2025-12-09T07:30:28Z
0.69
2025-12-09T08:30:30Z
0.75
2025-12-09T09:30:32Z
0.66
2025-12-09T09:31:05Z
0.68
2025-12-09T09:31:35Z
0.60
2025-12-09T09:32:06Z
0.65
2025-12-09T09:32:37Z
0.79
2025-12-09T09:33:08Z
0.61
2025-12-09T09:33:38Z
0.66
2025-12-09T09:34:09Z
0.64
2025-12-09T09:34:40Z
0.61
2025-12-09T09:35:10Z
0.64
2025-12-09T09:35:41Z
0.64
2025-12-09T09:36:12Z
0.60
2025-12-09T09:36:42Z
0.65
2025-12-09T09:37:13Z
0.63
2025-12-09T09:37:44Z
0.70
2025-12-09T09:38:14Z
0.71
2025-12-09T09:38:45Z
0.62
2025-12-09T09:39:16Z
0.61
2025-12-09T09:39:46Z
0.65
2025-12-09T09:40:17Z
0.68
2025-12-09T09:40:48Z
0.65
2025-12-09T09:41:19Z
0.60
2025-12-09T09:41:49Z
0.71
2025-12-09T09:42:20Z
0.61
2025-12-09T09:42:51Z
0.63
2025-12-09T09:43:21Z
0.67
2025-12-09T09:43:52Z
0.60
2025-12-09T09:44:23Z
0.63
2025-12-09T09:44:53Z
0.67
2025-12-09T09:45:24Z
0.75
2025-12-09T09:45:55Z
0.68
2025-12-09T09:46:26Z
0.65
2025-12-09T09:46:56Z
0.60
2025-12-09T09:47:27Z
0.58
2025-12-09T09:47:58Z
0.69
2025-12-09T09:48:28Z
0.75
2025-12-09T09:48:59Z
0.61
2025-12-09T09:49:30Z
0.75
2025-12-09T09:50:01Z
0.60
2025-12-09T09:50:31Z
0.61
2025-12-09T09:51:02Z
0.61
2025-12-09T09:51:33Z
0.68
2025-12-09T09:52:03Z
0.64
2025-12-09T09:52:35Z
1.51
2025-12-09T09:53:16Z
11.42
2025-12-09T09:53:47Z
0.64
2025-12-09T09:54:25Z
8.04
2025-12-09T09:55:03Z
7.80
2025-12-09T09:55:34Z
0.69
2025-12-09T09:56:11Z
7.70
2025-12-09T09:56:42Z
0.65
2025-12-09T09:57:20Z
7.59
2025-12-09T09:57:58Z
7.80
2025-12-09T09:58:29Z
1.49
2025-12-09T09:59:08Z
8.67
2025-12-09T09:59:38Z
0.62
2025-12-09T10:00:16Z
7.85
2025-12-09T10:00:54Z
7.54
2025-12-09T10:01:25Z
0.66
2025-12-09T10:02:37Z
42.59
2025-12-09T10:03:46Z
38.66
2025-12-09T10:04:56Z
39.57
2025-12-09T10:06:05Z
38.97
2025-12-09T10:07:14Z
39.00
2025-12-09T10:08:15Z
31.23
2025-12-09T10:09:17Z
31.65
2025-12-09T10:10:19Z
32.73
2025-12-09T10:10:50Z
0.65
2025-12-09T10:11:25Z
4.51
2025-12-09T10:11:55Z
0.63
2025-12-09T10:12:30Z
4.22
2025-12-09T10:13:13Z
13.15
2025-12-09T10:13:43Z
0.59
2025-12-09T10:14:26Z
12.58
2025-12-09T10:15:08Z
11.86
2025-12-09T10:15:39Z
0.67
2025-12-09T10:16:29Z
20.24
2025-12-09T10:17:19Z
19.80
2025-12-09T10:18:08Z
19.63
2025-12-09T10:18:58Z
19.70
2025-12-09T10:19:29Z
0.62
2025-12-09T10:20:15Z
16.18
2025-12-09T10:21:01Z
16.16
2025-12-09T10:21:40Z
8.41
2025-12-09T10:22:10Z
0.56
2025-12-09T10:22:49Z
8.65
2025-12-09T10:23:27Z
8.28
2025-12-09T10:23:58Z
0.69
2025-12-09T10:24:29Z
0.62
2025-12-09T10:24:59Z
0.60
2025-12-09T10:25:30Z
0.63
2025-12-09T10:26:01Z
0.68
2025-12-09T10:26:32Z
0.63
2025-12-09T10:27:02Z
0.67
2025-12-09T10:27:33Z
0.61
2025-12-09T10:28:04Z
0.70
2025-12-09T10:28:34Z
0.59
2025-12-09T10:29:05Z
0.64
2025-12-09T10:29:36Z
0.66
2025-12-09T10:30:07Z
0.83
2025-12-09T10:30:37Z
0.58
2025-12-09T10:31:09Z
0.58
2025-12-09T10:31:40Z
0.66
2025-12-09T10:32:11Z
0.71
2025-12-09T10:32:42Z
0.68
2025-12-09T10:33:23Z
11.10
2025-12-09T10:33:57Z
4.72
2025-12-09T10:34:28Z
0.63
2025-12-09T10:35:07Z
8.48
2025-12-09T10:35:46Z
8.89
2025-12-09T10:36:16Z
0.60
2025-12-09T10:36:55Z
8.44
2025-12-09T10:37:26Z
0.76
2025-12-09T10:38:04Z
8.63
2025-12-09T10:38:43Z
8.72
2025-12-09T10:39:14Z
0.69
2025-12-09T10:39:52Z
8.38
2025-12-09T10:40:23Z
0.60
2025-12-09T10:41:02Z
9.04
2025-12-09T10:41:40Z
8.12
2025-12-09T10:42:11Z
0.61
2025-12-09T10:42:45Z
4.46
2025-12-09T10:43:16Z
0.62
2025-12-09T10:43:47Z
0.65
2025-12-09T10:44:17Z
0.66
2025-12-09T10:44:49Z
1.54
2025-12-09T10:45:20Z
0.74
2025-12-09T10:45:50Z
0.69
2025-12-09T10:46:21Z
0.63
2025-12-09T10:46:56Z
4.57
2025-12-09T10:47:30Z
4.81
2025-12-09T10:48:05Z
4.53
2025-12-09T10:48:36Z
0.66
2025-12-09T10:49:10Z
4.33
2025-12-09T10:49:41Z
0.69
2025-12-09T10:50:16Z
5.37
2025-12-09T10:50:51Z
5.04
2025-12-09T10:51:22Z
0.60
2025-12-09T10:51:56Z
4.27
2025-12-09T10:52:27Z
0.64
2025-12-09T10:53:02Z
4.56
2025-12-09T10:53:36Z
4.44
2025-12-09T10:54:07Z
0.68
2025-12-09T10:54:41Z
4.13
2025-12-09T10:55:13Z
1.73
2025-12-09T10:55:43Z
0.62
2025-12-09T10:56:14Z
0.65
2025-12-09T10:56:45Z
0.64
2025-12-09T10:57:15Z
0.63
2025-12-09T10:57:47Z
1.76
2025-12-09T10:58:18Z
0.65
2025-12-09T10:58:50Z
1.56
2025-12-09T10:59:20Z
0.65
2025-12-09T10:59:51Z
0.65
2025-12-09T11:00:25Z
3.77
2025-12-09T11:00:56Z
0.67
2025-12-09T11:01:26Z
0.66
2025-12-09T11:02:34Z
37.92
2025-12-09T11:03:35Z
31.06
2025-12-09T11:04:53Z
47.48
2025-12-09T11:06:04Z
41.15
2025-12-09T11:07:29Z
55.22
2025-12-09T11:09:06Z
66.50
2025-12-09T11:10:50Z
74.15
2025-12-09T11:11:59Z
38.81
2025-12-09T11:13:08Z
38.82
2025-12-09T11:14:18Z
40.15
2025-12-09T11:15:23Z
34.57
2025-12-09T11:17:19Z
86.04
2025-12-09T11:19:16Z
87.13
2025-12-09T11:21:08Z
82.16
2025-12-09T11:23:01Z
82.71
2025-12-09T11:24:54Z
82.74
2025-12-09T11:25:59Z
35.28
2025-12-09T11:27:03Z
34.43
2025-12-09T11:28:07Z
34.09
2025-12-09T11:29:14Z
36.10
2025-12-09T11:30:19Z
35.48
2025-12-09T11:31:31Z
42.26
2025-12-09T11:32:54Z
51.12
2025-12-09T11:34:13Z
48.29
2025-12-09T11:35:39Z
56.04
2025-12-09T11:37:01Z
52.80
2025-12-09T11:38:28Z
56.74
2025-12-09T11:39:56Z
57.57
2025-12-09T11:41:23Z
57.50
2025-12-09T11:42:50Z
56.38
2025-12-09T11:44:16Z
56.53
2025-12-09T11:45:43Z
56.62
2025-12-09T11:47:10Z
56.68
2025-12-09T11:48:53Z
73.00
2025-12-09T11:50:37Z
73.87
2025-12-09T11:52:45Z
97.71
2025-12-09T11:54:42Z
87.12
2025-12-09T11:56:22Z
70.35
2025-12-09T11:58:14Z
81.99
2025-12-09T12:00:13Z
88.62
2025-12-09T12:03:27Z
163.75
2025-12-09T12:08:36Z
279.60
2025-12-09T12:13:34Z
268.14
2025-12-09T12:16:33Z
148.20
2025-12-09T12:19:34Z
151.05
2025-12-09T12:22:49Z
165.68
2025-12-09T12:26:05Z
165.76
2025-12-09T12:29:26Z
170.54
2025-12-09T12:32:52Z
176.35
2025-12-09T12:38:14Z
289.79
2025-12-09T12:43:41Z
297.70
2025-12-09T12:48:05Z
234.02
2025-12-09T12:53:03Z
267.09
2025-12-09T12:57:49Z
256.31
2025-12-09T13:02:15Z
235.77
2025-12-09T13:09:06Z
380.96
2025-12-09T13:17:38Z
481.72
2025-12-09T13:24:09Z
361.22
2025-12-09T13:30:26Z
347.29
2025-12-09T13:37:02Z
365.45
2025-12-09T13:45:54Z
500.58
2025-12-09T13:52:07Z
343.13
2025-12-09T13:58:16Z
338.70
2025-12-09T14:04:34Z
348.58
2025-12-09T14:12:57Z
472.51
2025-12-09T14:19:55Z
388.25
2025-12-09T14:28:39Z
493.23
2025-12-09T14:36:13Z
424.11
2025-12-09T14:43:52Z
429.35
2025-12-09T14:50:53Z
399.76
2025-12-09T14:58:07Z
413.56
2025-12-09T15:05:16Z
409.29
2025-12-09T15:12:35Z
418.78
2025-12-09T15:19:39Z
404.16
2025-12-09T15:26:56Z
417.08
2025-12-09T15:34:15Z
418.32
2025-12-09T15:41:29Z
414.65
2025-12-09T15:48:34Z
404.07
2025-12-09T15:56:23Z
447.98
2025-12-09T16:03:48Z
424.80
2025-12-09T16:11:26Z
438.26
2025-12-09T16:19:05Z
438.25
2025-12-09T16:27:25Z
480.47
2025-12-09T16:35:09Z
443.42
2025-12-09T16:43:38Z
489.28
2025-12-09T16:51:48Z
470.38
2025-12-09T17:00:05Z
474.90
2025-12-09T17:08:15Z
470.60
2025-12-09T17:17:16Z
520.60
2025-12-09T17:25:40Z
483.91
2025-12-09T17:34:02Z
482.29
2025-12-09T17:42:33Z
490.55
2025-12-09T17:50:55Z
482.39
2025-12-09T17:59:19Z
483.09
2025-12-09T18:07:43Z
482.90
2025-12-09T18:16:16Z
492.75
2025-12-09T18:24:55Z
499.06
2025-12-09T18:33:43Z
508.15
2025-12-09T18:42:37Z
513.96
2025-12-09T18:51:33Z
515.80
2025-12-09T19:00:43Z
530.09
2025-12-09T19:09:48Z
523.03
2025-12-09T19:18:58Z
530.14
2025-12-09T19:28:14Z
535.70
2025-12-09T19:37:30Z
536.40
2025-12-09T19:46:29Z
518.54
2025-12-09T19:55:45Z
536.28
2025-12-09T20:04:51Z
525.72
2025-12-09T20:13:29Z
496.35
2025-12-09T20:21:44Z
474.67
2025-12-09T20:29:37Z
453.54
2025-12-09T20:38:14Z
496.30
2025-12-09T20:46:14Z
460.47
2025-12-09T20:54:34Z
479.92
2025-12-09T21:02:39Z
465.30
2025-12-09T21:11:22Z
502.49
2025-12-09T21:23:05Z
671.19
2025-12-09T21:35:38Z
723.52
2025-12-09T21:47:31Z
682.09
2025-12-09T21:58:53Z
652.43
2025-12-09T22:09:44Z
620.91
2025-12-09T22:21:22Z
667.54
2025-12-09T22:32:45Z
651.95
2025-12-09T22:44:26Z
670.17
2025-12-09T22:55:16Z
620.55
2025-12-09T23:06:06Z
619.74"""

# Parse the data
lines = data_raw.strip().split("\n")
cycles = []
for i in range(0, len(lines), 2):
    ts = datetime.fromisoformat(lines[i].replace("Z", "+00:00"))
    duration = float(lines[i + 1])
    cycles.append({"timestamp": ts, "duration": duration, "hour": ts.hour})

# Sort by timestamp
cycles.sort(key=lambda x: x["timestamp"])

# Analyze by hour buckets
print("=" * 80)
print("CYCLE PERFORMANCE BY HOUR (CST = UTC - 6)")
print("=" * 80)
print(
    f"{'Hour (CST)':<15} {'Cycles':<10} {'Avg Duration':<15} {'Min':<10} {'Max':<10} {'Cycles/Hr'}"
)
print("-" * 80)

hour_stats = {}
for cycle in cycles:
    hour_utc = cycle["hour"]
    hour_cst = (hour_utc - 6) % 24

    if hour_cst not in hour_stats:
        hour_stats[hour_cst] = []
    hour_stats[hour_cst].append(cycle["duration"])

for hour_cst in sorted(hour_stats.keys()):
    durations = hour_stats[hour_cst]
    avg_dur = statistics.mean(durations)
    min_dur = min(durations)
    max_dur = max(durations)
    cycle_count = len(durations)

    # Calculate cycles per hour (3600 seconds / avg duration)
    cycles_per_hr = 3600 / avg_dur if avg_dur > 0 else 0

    print(
        f"{hour_cst:02d}:00 - {hour_cst:02d}:59  {cycle_count:<10} "
        f"{avg_dur:>10.2f}s    {min_dur:>6.2f}s   {max_dur:>6.2f}s   "
        f"{cycles_per_hr:>6.1f}"
    )

# Identify key time periods
print("\n" + "=" * 80)
print("PROGRESSIVE SLOWDOWN ANALYSIS")
print("=" * 80)

# Early morning (4:30 AM CST ~ 10:30 UTC)
early_cycles = [c for c in cycles if 10 <= c["hour"] <= 11]
if early_cycles:
    early_avg = statistics.mean([c["duration"] for c in early_cycles])
    early_rate = 3600 / early_avg
    print(
        f"Early Morning (4:30-5:30 AM CST): {early_avg:.2f}s avg -> {early_rate:.1f} cycles/hr"
    )

# Midday (11 AM - 1 PM CST ~ 17-19 UTC)
midday_cycles = [c for c in cycles if 17 <= c["hour"] <= 19]
if midday_cycles:
    midday_avg = statistics.mean([c["duration"] for c in midday_cycles])
    midday_rate = 3600 / midday_avg
    print(
        f"Midday (11 AM - 1 PM CST):         {midday_avg:.2f}s avg -> {midday_rate:.1f} cycles/hr"
    )

# Afternoon (2-4 PM CST ~ 20-22 UTC)
afternoon_cycles = [c for c in cycles if 20 <= c["hour"] <= 22]
if afternoon_cycles:
    afternoon_avg = statistics.mean([c["duration"] for c in afternoon_cycles])
    afternoon_rate = 3600 / afternoon_avg
    print(
        f"Afternoon (2-4 PM CST):            {afternoon_avg:.2f}s avg -> "
        f"{afternoon_rate:.1f} cycles/hr"
    )

# Late afternoon/evening (4-6 PM CST ~ 22-00 UTC, wrapping midnight)
late_cycles = [c for c in cycles if c["hour"] >= 22 or c["hour"] <= 1]
if late_cycles:
    late_avg = statistics.mean([c["duration"] for c in late_cycles])
    late_rate = 3600 / late_avg
    print(
        f"Late Afternoon (4-6 PM CST):       {late_avg:.2f}s avg -> {late_rate:.1f} cycles/hr"
    )

# Key insights
print("\n" + "=" * 80)
print("KEY FINDINGS")
print("=" * 80)

# Find the transition point where cycles started slowing
transition_found = False
for i in range(len(cycles) - 1):
    if cycles[i]["duration"] < 100 and cycles[i + 1]["duration"] > 100:
        ts_cst_hour = (cycles[i + 1]["hour"] - 6) % 24
        print(
            f"Slowdown begins: {cycles[i+1]['timestamp'].strftime('%Y-%m-%d %H:%M:%S UTC')}"
        )
        print(
            f"                 ({ts_cst_hour:02d}:{cycles[i+1]['timestamp'].minute:02d} CST)"
        )
        print(
            f"Duration jumped from {cycles[i]['duration']:.2f}s to {cycles[i+1]['duration']:.2f}s"
        )
        transition_found = True
        break

if not transition_found:
    print("No clear transition point found - checking gradual degradation...")

# Check if there's a gradual increase
durations_over_time = [
    c["duration"] for c in cycles if c["hour"] >= 10
]  # From 4 AM CST onward
if len(durations_over_time) > 10:
    first_10_avg = statistics.mean(durations_over_time[:10])
    last_10_avg = statistics.mean(durations_over_time[-10:])
    print(f"\nFirst 10 cycles after 4 AM CST: {first_10_avg:.2f}s avg")
    print(f"Last 10 cycles in logs:          {last_10_avg:.2f}s avg")
    print(f"Degradation factor:              {last_10_avg/first_10_avg:.2f}x slower")

print("\n")
